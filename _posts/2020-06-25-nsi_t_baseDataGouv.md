---
keywords: fastai
description: Cours NSI Terminale - Thème 2.
title: Exploiter un vrai jeu de donnée
toc: true 
badges: true
comments: false
categories: [python,  NSI,   Terminale,   Bases de données,   SQL,   TP]
image: /images/nsi2.png
nb_path: _notebooks/2020-06-25-nsi_t_baseDataGouv.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-06-25-nsi_t_baseDataGouv.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Mise-en-pratique-sur-une-vraie-base">Mise en pratique sur une vraie base<a class="anchor-link" href="#Mise-en-pratique-sur-une-vraie-base"> </a></h2><p>A partir de maintenant, vous avez les connaissances pour réaliser une application s'appuyant sur une base de donénes. Il  ne reste plus qu'à les appliquer dans le cadre d'un projet ou un mini projet. Un exemple de mini-projet possible dans le domaine du <em>BigData</em> consiste à récupérer des données officielles et à s'aider du langage SQL pour les exploiter.</p>
<h2 id="Exemple-de-jeu-de-donn&#233;es">Exemple de jeu de donn&#233;es<a class="anchor-link" href="#Exemple-de-jeu-de-donn&#233;es"> </a></h2><p>Une source intéressante pour récupérer des données est <strong>data.gouv.fr</strong>. Voici un exemple de jeu de données : <a href="https://www.data.gouv.fr/fr/datasets/resultats-du-controle-sanitaire-de-leau-distribuee-commune-par-commune/#_">https://www.data.gouv.fr/fr/datasets/resultats-du-controle-sanitaire-de-leau-distribuee-commune-par-commune/#_</a></p>
<p>La description de chacun des fichiers se trouve ici : <a href="https://static.data.gouv.fr/resources/resultats-du-controle-sanitaire-de-leau-distribuee-commune-par-commune/20190710-030936/20190708-eau-distrib-documentation-v4.pdf">https://static.data.gouv.fr/resources/resultats-du-controle-sanitaire-de-leau-distribuee-commune-par-commune/20190710-030936/20190708-eau-distrib-documentation-v4.pdf</a></p>
<ol>
<li>Téléchargez le fichier dis-* le plus récent. Décompressez le et anasysez sa structure.</li>
<li>Créez une nouvelle base de données et 3 tables à l'intérieur :<ul>
<li>Communes</li>
<li>Prelevements</li>
<li>Resultats</li>
</ul>
</li>
<li>Créez dans chacune des tables une clé primaire nommée Id<em>NomTable</em> ainsi que des attributs correspondants aux intitulés de colonne</li>
<li>A l'aide de Python, lisez chacun des fichiers et peuplez les tables correspondantes.</li>
<li>Créez des requêtes SQL afin de vous renseigner sur la qualité de l'eau dans les communes proches de chez vous.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Cr&#233;ation-des-tables">Cr&#233;ation des tables<a class="anchor-link" href="#Cr&#233;ation-des-tables"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="n">bdd</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;dis_db&quot;</span><span class="p">)</span>
<span class="n">curseur</span> <span class="o">=</span> <span class="n">bdd</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Creation table Communes</span>
<span class="n">requete</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">CREATE TABLE Communes</span>
<span class="s2">(</span>
<span class="s2">    IdCommune INTEGER  PRIMARY KEY,</span>
<span class="s2">    inseecommune TEXT,</span>
<span class="s2">    nomcommune TEXT,</span>
<span class="s2">    quartier TEXT,</span>
<span class="s2">    cdreseau TEXT,</span>
<span class="s2">    nomreseau TEXT,</span>
<span class="s2">    debutalim DATE</span>
<span class="s2">);&quot;&quot;&quot;</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>

<span class="c1"># Creation des tables Prelevements et Resultats</span>

<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<span class="c1"># On enregistre les changements !</span>

<span class="n">bdd</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Alimentation-de-la-base-de-donn&#233;es">Alimentation de la base de donn&#233;es<a class="anchor-link" href="#Alimentation-de-la-base-de-donn&#233;es"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Exemple d&#39;import d&#39;un fichier CSV dans une BDD</span>

<span class="kn">import</span> <span class="nn">csv</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;DIS_COM_UDI_2020.txt&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
    <span class="n">nb_lignes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">lignes</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvfile</span><span class="p">)</span>
    <span class="n">entete</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lignes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">entete</span><span class="p">:</span>
            <span class="n">entete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nb_lignes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">requete</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            INSERT INTO Communes</span>
<span class="s2">                (inseecommune,nomcommune,quartier,cdreseau,nomreseau,debutalim)</span>
<span class="s2">            VALUES</span>
<span class="s2">                (?, ?, ?, ?, ?, ?)</span>
<span class="s2">            &quot;&quot;&quot;</span>
            <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="n">bdd</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nb_lignes</span><span class="si">}</span><span class="s2"> enregistrements créés&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Procédez de même pour le fichier prélèvement</span>

<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM Prelevements;&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">126730</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># et enfin le fichier Resultat</span>

<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM Resultats;&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3683342</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Interrogation-de-la-base-de-donn&#233;es">Interrogation de la base de donn&#233;es<a class="anchor-link" href="#Interrogation-de-la-base-de-donn&#233;es"> </a></h3><p>Nous avons à présent une vraie base de données avec de vraies données, en nombre conséquant. Une petite requête sur la table Resultats suffit pour s'en convaincre : Plus de 3 millions et demi d'enregistrements !</p>
<h3 id="Quelques-id&#233;es-de-fonctions-&#224;-cr&#233;er-!">Quelques id&#233;es de fonctions &#224; cr&#233;er !<a class="anchor-link" href="#Quelques-id&#233;es-de-fonctions-&#224;-cr&#233;er-!"> </a></h3><ul>
<li><p>une fonction <strong>liste_communes</strong> prenant en entrée un curseur et un numéro de département et renvoyant la liste des communes dans de département présentes dans la base.</p>
<ul>
<li>La fonction ne renverra pas plusieurs fois la même commune</li>
<li>Attention, pour un numéro de département inférieur à 10, if faut penser à ajouter "0"...</li>
<li>Le champ <em>numeroinsee</em> commence par le numéro du département mais est différent du code postal.</li>
</ul>
</li>
<li><p>une fonction <strong>anomalies()</strong> prenant un curseur et un nom de commune et qui renvoie la date et la conclusion du prélévement (champ <em>conclusionprel</em> dans <strong>Prelevements</strong> dans la commune) et la référence du prélèvement (champ <em>referenceprel</em> dans ùùPrelevements**) en cas d'anomalie. Vous repèrerez dans la base la phrase type lorsque tout va bien !</p>
</li>
<li><p>une fonction <strong>resultat()</strong> prenant en paramètres un curseur et une référence de prélèvement et qui renvoie les résultats détaillés de l'analyse avec les informatiuons suivantes :</p>
<ul>
<li>libellé associé à chaque code paramètre, composant la dénomination du paramètre sous forme de texte libre</li>
<li>Le résultat de l’analyse physico-chimique ou microbiologique du paramètre</li>
<li>L'unité de mesure du paramètre</li>
<li>La limite(s) de qualité du paramètre concernéen vigueur  au moment du prélèvement</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="s2">&quot;CAEN&quot;</span> <span class="ow">in</span> <span class="n">liste_communes</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">anomalies</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="s2">&quot;HEROUVILLE-SAINT-CLAIR&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">resultats</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="s2">&quot;01400207768&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Amusez-vous">Amusez vous<a class="anchor-link" href="#Amusez-vous"> </a></h3><p>Interrogez la base de données pour rechercher des anomalies dans votre commune ou les environs, et récupérez les résultats détaillés des ananlyses en cas de problème pour identifier la source de l'anomalie.</p>
<p>Au fil de votre parcours de la base, vous pouvez avoir envie de créer d'autres fonctions pour afficher d'autres informations. Ne vous provez pas !!!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Amusez vous !</span>
<span class="n">liste_communes</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pour-aller-plus-loin">Pour aller plus loin<a class="anchor-link" href="#Pour-aller-plus-loin"> </a></h3><p>Vous avez les outils à présent pout construire une application graphique (avec TKInter par exemple) ou bien un site web mettant à disposition ces résultats. Cela peut faire l'objet d'un projet.</p>
<h2 id="Fin-du-travail">Fin du travail<a class="anchor-link" href="#Fin-du-travail"> </a></h2><p>On n'oublie pas de fermer l'accès à la base de données :)</p>
<p>Vous aurez pu constater au cours de vos requêtes que les réponses de la base de donnée sont immédiate malgré les millions d'enregistrement que celle-ci contient !!</p>
<p>Voici un petit aperçu de l'utilisation d'une base de donnée dans le monde réel.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bdd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

