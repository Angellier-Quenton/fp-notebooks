<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Bases de données avec Python | notebooks</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bases de données avec Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Cours NSI Terminale - Thème 2." />
<meta property="og:description" content="Cours NSI Terminale - Thème 2." />
<link rel="canonical" href="https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html" />
<meta property="og:url" content="https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html" />
<meta property="og:site_name" content="notebooks" />
<meta property="og:image" content="https://notebooks.lecluse.fr/images/nsi2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-25T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Cours NSI Terminale - Thème 2.","@type":"BlogPosting","headline":"Bases de données avec Python","url":"https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html","datePublished":"2020-06-25T00:00:00-05:00","dateModified":"2020-06-25T00:00:00-05:00","image":"https://notebooks.lecluse.fr/images/nsi2.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://notebooks.lecluse.fr/feed.xml" title="notebooks" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Bases de données avec Python | notebooks</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bases de données avec Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Cours NSI Terminale - Thème 2." />
<meta property="og:description" content="Cours NSI Terminale - Thème 2." />
<link rel="canonical" href="https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html" />
<meta property="og:url" content="https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html" />
<meta property="og:site_name" content="notebooks" />
<meta property="og:image" content="https://notebooks.lecluse.fr/images/nsi2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-25T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Cours NSI Terminale - Thème 2.","@type":"BlogPosting","headline":"Bases de données avec Python","url":"https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html","datePublished":"2020-06-25T00:00:00-05:00","dateModified":"2020-06-25T00:00:00-05:00","image":"https://notebooks.lecluse.fr/images/nsi2.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://notebooks.lecluse.fr/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://notebooks.lecluse.fr/feed.xml" title="notebooks" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">notebooks</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">A propos</a><a class="page-link" href="/">Notebooks Jupyter</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a><a class="page-link" href="/page2/">Notebooks Jupyter</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Bases de données avec Python</h1><p class="page-description">Cours NSI Terminale - Thème 2.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-25T00:00:00-05:00" itemprop="datePublished">
        Jun 25, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      5 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#NSI">NSI</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Terminale">Terminale</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#Bases de données">Bases de données</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#SQL">SQL</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#TP">TP</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/wawachief/fp-notebooks/tree/master/_notebooks/2020-06-25-nsi_t_PythonSql.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/wawachief/fp-notebooks/master?filepath=_notebooks%2F2020-06-25-nsi_t_PythonSql.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/wawachief/fp-notebooks/blob/master/_notebooks/2020-06-25-nsi_t_PythonSql.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Exploiter-une-base-de-données-avec-Python">Exploiter une base de données avec Python </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Exécuter-des-requêtes-de-sélection">Exécuter des requêtes de sélection </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Le-principe">Le principe </a></li>
<li class="toc-entry toc-h3"><a href="#Construire-des-requêtes-à-partir-de-variables-python">Construire des requêtes à partir de variables python </a></li>
<li class="toc-entry toc-h3"><a href="#Explications">Explications </a></li>
<li class="toc-entry toc-h3"><a href="#A-vous-de-jouer">A vous de jouer </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Insérer-de-nouveaux-enregistrements">Insérer de nouveaux enregistrements </a>
<ul>
<li class="toc-entry toc-h3"><a href="#A-vous-de-jouer">A vous de jouer </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Pour-Finir">Pour Finir </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-06-25-nsi_t_PythonSql.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Exploiter-une-base-de-données-avec-Python">
<a class="anchor" href="#Exploiter-une-base-de-donn%C3%A9es-avec-Python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exploiter une base de données avec Python<a class="anchor-link" href="#Exploiter-une-base-de-donn%C3%A9es-avec-Python"> </a>
</h1>
<p>Dans ce TP, nous allons reprendre notre base de données d'exemples sur les livres, mais nous allons utiliser Python pour exécuter et exploiter les requêtes SQL. Notre SGBD sera toujours SQLite : le module python que nous utiliserons se nomme <strong>sqlite3</strong>.</p>
<p>Si vous ne possédez pas cette base des TP précédents, vous pouvez la récupérer <a href="https://www.lecluse.fr/nsi/NSI_T/bdd/livres_db">ici</a>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Le module étant importé, nous devons réaliser deux actions pour pouvoir commencer à utiliser notre base :</p>
<ul>
<li>ouvrir le fichier de base de données</li>
<li>créer un curseur</li>
</ul>
<p>Le <em>curseur</em> est un objet python offrant des méthodes pour exécuter des requêtes et récupérer le ou les résultats de ces requêtes.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bdd</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">"livres_db"</span><span class="p">)</span>
<span class="n">curseur</span> <span class="o">=</span> <span class="n">bdd</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>livres_db</em> est le nom du fichier contenant la base de donnéees SQLite que nous allons exploiter. Si le fichier n'existe pas, une nouvelle base de données sera créée.</p>
<h2 id="Exécuter-des-requêtes-de-sélection">
<a class="anchor" href="#Ex%C3%A9cuter-des-requ%C3%AAtes-de-s%C3%A9lection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exécuter des requêtes de sélection<a class="anchor-link" href="#Ex%C3%A9cuter-des-requ%C3%AAtes-de-s%C3%A9lection"> </a>
</h2>
<h3 id="Le-principe">
<a class="anchor" href="#Le-principe" aria-hidden="true"><span class="octicon octicon-link"></span></a>Le principe<a class="anchor-link" href="#Le-principe"> </a>
</h3>
<p>Reste ensuite à exécuter notre première requête. Pour cela, nous utiliserons la méthode <strong>execute()</strong> du curseur, la requête étant une chaîne de caractères passée en paramètre.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requete</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Livres;"</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pour visualiser le résultat de notre requête, nous utiliserons encore notre curseur. Deux méthodes permettent principalement de le faire :</p>
<ul>
<li>
<strong>fetchone()</strong> pour récupérer un résultat puis avancer le curseur d'un cran</li>
<li>
<strong>fetchall()</strong> pour récupérer d'un coup tous les résultats. </li>
</ul>
<p>Regardez les exemples ci-dessous pour mieux comprendre comment fonctionne le curseur : il s'agit littéralement d'un curseur que l'on déplace de résultat en résultat. Vous vous en rendrez compte en exécutant plusieurs fois la cellule ci-dessous.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Vous constatez que le résultat est un <em>tuple</em>  dont les éléments correspondent aux attributs sélectionnés : ici c'est *. Il n'est pas facile de se rappeler de l'ordre des attributs. Pour cela vous pouvez faire appel à la propriété :</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">description</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>et pour rendre la réponse plus lisible, une petite liste en compréhension ;). Et voilà les attributs de colonne en clair dans l'ordre ou ils apparaissent dans le résultat de la requête !</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">curseur</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A présent, le fonctionnement de <strong>fetchall()</strong> ne devrait pas vous étonner : on récupère logiquement un tuple avec tous les résultats.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Si vous avez suivi les instructions précédentes, vous devriez constater qu'il manque des enregistrements. Pourquoi ?
Un indice : si vous réexécutez une nouvelle fois la méthode <strong>fetchall()</strong> du curseur, celle-ci ne renverra rien !</p>
<p>Et oui, c'est la notion de curseur qui se déplace au fur à mesure qu'unb résultat est donné : les précédents appels de <strong>fetchone()</strong> ont fait avancer le curseur, et de même, <strong>fetchall()</strong> positionne le curseur à la toute fin.</p>
<p>Pour retrouver tous les résultats à nouveau, il faut réexécuter la requête. Evitez donc de mélanger <strong>fetchone()</strong> et <strong>fetchall()</strong> sous peine de ne plus trop savoir ou en est le curseur et ce que vous récupérez.</p>
<p>Voici donc le moyen le plus simple de récupérer tous les résultats d'une requête d'un coup.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>
<span class="n">resultats</span> <span class="o">=</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">resultats</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Construire-des-requêtes-à-partir-de-variables-python">
<a class="anchor" href="#Construire-des-requ%C3%AAtes-%C3%A0-partir-de-variables-python" aria-hidden="true"><span class="octicon octicon-link"></span></a>Construire des requêtes à partir de variables python<a class="anchor-link" href="#Construire-des-requ%C3%AAtes-%C3%A0-partir-de-variables-python"> </a>
</h3>
<p>Nous allons dans l'exemple suivant écrire une fonction <strong>prenom()</strong></p>
<ul>
<li>qui prend en paramètre un curseur et un nom d'auteur</li>
<li>qui renvoie son prénom</li>
</ul>
<p>Si le nom de l'auteur ne figure pas dans la table <em>Auteurs</em>, la fonction renverra <strong>None</strong>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prenom</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">nom</span><span class="p">):</span>
    <span class="n">requete</span> <span class="o">=</span> <span class="s2">"SELECT PrenomAuteur FROM Auteurs WHERE NomAuteur = ?"</span>
    <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">,</span> <span class="p">[</span><span class="n">nom</span><span class="p">])</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">prenom</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="s2">"Verne"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Explications">
<a class="anchor" href="#Explications" aria-hidden="true"><span class="octicon octicon-link"></span></a>Explications<a class="anchor-link" href="#Explications"> </a>
</h3>
<p>Dans cet exemple, nous construisons une requête à partir d'une variable Python. SQLite propose un mécanisme de substitution sécurisé permettant d'injecter une ou plusieurs variables à l'intérieur d'une requête. <strong>C'est ce mécanisme que vous devez utiliser</strong> : ne construisez pas vous même la chaîne de caractère contenant la requête complète, c'est une mauvaise pratique qui vous conduira inévitablement à des problèmes.</p>
<p>Pour utiliser ce mécanisme de substitution, vous devez</p>
<ul>
<li>mettre des <strong>?</strong> dans votre requête à l'emplacement de la variable à insérer</li>
<li>passer en second paramètre la liste des valeurs à substituer dans la requête</li>
</ul>
<p>C'est simple, fiable et sécurisé, en particulier contre les <a href="https://xkcd.com/327/">injections SQL</a> !</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-vous-de-jouer">
<a class="anchor" href="#A-vous-de-jouer" aria-hidden="true"><span class="octicon octicon-link"></span></a>A vous de jouer<a class="anchor-link" href="#A-vous-de-jouer"> </a>
</h3>
<p>Ecrivez une fonction <strong>romans()</strong></p>
<ul>
<li>qui prend en paramètre un curseur et un nom d'auteur</li>
<li>qui renvoie une liste de <em>Titres</em> de romans écrits par cet auteur</li>
</ul>
<p>Si le nom de l'auteur ne figure pas dans la table <em>Auteurs</em>, la fonction renverra <strong>None</strong>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">romans</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">nom</span><span class="p">):</span>
    <span class="c1"># YOUR CODE HERE</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">romans</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="s2">"Asimov"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'Fondation'</span><span class="p">,</span> <span class="s1">'Les Robots'</span><span class="p">,</span> <span class="s1">'La Fin de l’éternité'</span><span class="p">]</span>
<span class="k">assert</span> <span class="n">romans</span><span class="p">(</span><span class="n">curseur</span><span class="p">,</span> <span class="s2">"Verne"</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">'De la Terre à la Lune'</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Insérer-de-nouveaux-enregistrements">
<a class="anchor" href="#Ins%C3%A9rer-de-nouveaux-enregistrements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Insérer de nouveaux enregistrements<a class="anchor-link" href="#Ins%C3%A9rer-de-nouveaux-enregistrements"> </a>
</h2>
<p>Les requêtes de modification sur la base se font de la même manière que les requêtes de sélection, à une petite subtilité près : après exécution de la requête, il faudra faire appel à la méthode <strong>commit()</strong> de l'objet <em>bdd</em> (issu de la connexion) afin que les modifications soient prises en compte dans le fichier de base de données.</p>
<p><strong>Attention</strong> : Si vous oubliez l'appel à commit, vos modifications seront perdues lorsque vous quitterez votre programme car elles ne seront pas inscrites dans le fichier de la base de données.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requete</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">INSERT INTO Auteurs </span>
<span class="s2">  (NomAuteur, PrenomAuteur, IdLangue, AnneeNaissance)</span>
<span class="s2">VALUES</span>
<span class="s2">  ('Lecluse', 'Olivier', 2, 1870);</span>
<span class="s2">"""</span>

<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>
<span class="n">bdd</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>la propriété <strong>lastrowid</strong> peut être intéressante car elle donne accès à la clé primaire créée automatiquement pour notre nouvel enregistrement. En voici une utilisation :</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">last_id</span> <span class="o">=</span> <span class="n">curseur</span><span class="o">.</span><span class="n">lastrowid</span>
<span class="n">last_id</span> 
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requete</span> <span class="o">=</span> <span class="s2">"SELECT * FROM Auteurs WHERE IdAuteur = ?"</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">,</span> <span class="p">[</span><span class="n">last_id</span><span class="p">])</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-vous-de-jouer">
<a class="anchor" href="#A-vous-de-jouer" aria-hidden="true"><span class="octicon octicon-link"></span></a>A vous de jouer<a class="anchor-link" href="#A-vous-de-jouer"> </a>
</h3>
<p>Effacez de la table auteur ce dernier enregistrement que nous avons créé.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requete</span> <span class="o">=</span> <span class="s2">"SELECT COUNT(*) from Auteurs"</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM Auteurs"</span><span class="p">)</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pour-Finir">
<a class="anchor" href="#Pour-Finir" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pour Finir<a class="anchor-link" href="#Pour-Finir"> </a>
</h2>
<p>Notre travail sur la BDD exemple est à présent terminé. Afin de fermer le fichier proprement et de s'assurer que les données saisies seront bien inscrites dans le fichier, il faut <em>impérativement</em> appeler la méthode <strong>close()</strong> sur l'objet <em>bdd</em> :</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bdd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">curseur</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A partir de ce moment là, plus acune opération n'est possible sur la base de données comme le montre la cellule suivante :</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">requete</span> <span class="o">=</span> <span class="s2">"SELECT COUNT(*) from Auteurs"</span>
<span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">requete</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/python/nsi/terminale/bases%20de%20donn%C3%A9es/sql/tp/2020/06/25/nsi_t_PythonSql.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Plateforme de blog avec support pour Jupyter Notebooks.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/wawachief" title="wawachief"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/leclusemaths" title="leclusemaths"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
